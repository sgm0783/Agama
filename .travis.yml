sudo: required
os: linux
dist: xenial
language: node_js
node_js:
- lts/*
env:
  global:
  - CCACHE_SIZE=100M
  - CCACHE_TEMPDIR=/tmp/.ccache-temp
  - CCACHE_COMPRESS=1
  - AGAMA_VERSION=0.3.3
  - PKG_VERSION=0.3.3
  - EASYDEX_BUILD=gs://$BUCKET/EasyDEX-GUI/$TRAVIS_BRANCH/build.tar.gz
  - EASYDEX_MASTER_BUILD=gs://$BUCKET/EasyDEX-GUI/master/build.tar.gz
cache:
  apt: true
  directories:
  - "$HOME/google-cloud-sdk/"
  - "$HOME/.ccache"
matrix:
  fast_finish: true
  include:
  - env: SETUP_BUILD_SCRIPT=binary_artifacts_linux.sh BUILD_DIR=Agama-linux-x64 KOMODO_COMPRESSED=verus-cli-linux.tar.gz
      ARTIFACT_SET=Linux64 BUILD_VARIANT=linux64 BUILD_SCRIPT=electron-build-linux.sh
  - env: SETUP_BUILD_SCRIPT=binary_artifacts_win.sh BUILD_DIR=Agama-win32-x64 KOMODO_COMPRESSED=verus-cli-windows.zip
      PACKAGES=winehq-devel ARTIFACT_SET=Win64 BUILD_VARIANT=win64 BUILD_SCRIPT=electron-build-windows.sh
  - env: SETUP_BUILD_SCRIPT=binary_artifacts_mac.sh BUILD_DIR=Agama-darwin-x64 KOMODO_SET=verus-cli/
      ARTIFACT_SET=Mac64 BUILD_VARIANT=osx BUILD_SCRIPT=electron-build-osx.sh KOMODO_COMPRESSED=verus-cli-mac://ve.tar.gz
before_install:
- openssl aes-256-cbc -K $encrypted_a41fbd06a4b9_key -iv $encrypted_a41fbd06a4b9_iv
  -in AUTH_KEY.json.enc -out AUTH_KEY.json -d
- gcloud auth activate-service-account --key-file AUTH_KEY.json
- rm AUTH_KEY.json && rm AUTH_KEY.json.enc
- gsutil cp gs://$BUCKET/$EXECUTABLES/$TRAVIS_BRANCH/$KOMODO_COMPRESSED assets/bin/$BUILD_VARIANT ||
  gsutil cp gs://$BUCKET/$EXECUTABLES/master/$KOMODO_COMPRESSED assets/bin/$BUILD_VARIANT
- ./$SETUP_BUILD_SCRIPT
- cd gui/EasyDEX-GUI/react
- gsutil cp $EASYDEX_BUILD . || gsutil cp $EASYDEX_MASTER_BUILD .
- tar -xzvf build.tar.gz && rm build.tar.gz
- cd ../../..
install:
- if [ -n "$PACKAGES" ]; then sudo rm -f /etc/apt/sources.list.d/travis_ci_zeromq3-source.list;
  fi
- if [ -n "$PACKAGES" ]; then sudo dpkg --add-architecture i386 && wget -nc https://dl.winehq.org/wine-builds/Release.key;
  fi
- if [ -n "$PACKAGES" ]; then sudo apt-key add Release.key; fi
- if [ -n "$PACKAGES" ]; then sudo apt-add-repository https://dl.winehq.org/wine-builds/ubuntu/;
  fi
- if [ -n "$PACKAGES" ]; then travis_retry sudo apt-get update && sudo apt-get -y
  install --install-recommends -qq $PACKAGES; fi
- npm install electron-packager -g && npm install electron -g --unsafe-perm=true &&
  npm install
script:
- ./buildscripts/$BUILD_SCRIPT
- if [ "$MOD_PERMISSIONS" = "true" ]; then chmod +x build/$BUILD_DIR/Agama; fi
after_script:
- if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then cd build && tar -czf $BUILD_DIR.tar.gz
  $BUILD_DIR && gsutil cp $BUILD_DIR.tar.gz gs://$BUCKET/$PROJECT/$TRAVIS_BRANCH/;
  fi
notifications:
  slack:
    secure: tHddHa3l8QixuywIMOrSmsFfk3vGTcLXu/49IpDgYoO8IhZ91Ux6jBX1y9bK8mFwmjNzMUZBB4bH23JzQyv1JekQaihzCL4m5Ut8gcDRStUplO4Aye16DPTWzhy+UQYzkYwP/lEeTU/lNE/QEq7tC7nMbHn2kY9sC9dr5wHmBsGCeIB49ikaL2MdJThP0/9NFaBK/Z7eOmnd/l/76x2Vji2OvBYjjkCPPRE5bZ8Vvw6S/fA2abNirD3ymB9w7ooL4HzbZZw6gxKDSU0RcK8YCvYuDoEMDgcq//VEpZE852hmo9Pxs/LArcunztFmaoXxngwMejDM2VuDSELq/ytP/XpyTWC/bmOz+07BbPpUjZiu8psnxVerBt8l6oO34xU6R4U9JaqNdALJyMTO7gs9j53hZfi2Onr+/nxyJ9ec1gkJBzdIOnOxlZYXJOmuAtWBnoa5DvJvED9DBICIpkeTPzSJXMggAGDNHWmm4CoB1oHUbKUg3C5G7AGB63oHX9tDZ0A21ZOhMGx4DItQ6C7bH9FSp1FfA5CsnCO56JRaon+QF/vIO4y0OV+3QAL59kBDmy6P7VSzsGB07JApYJ/e9iLS2vXisSr6hM03rynSvVcfJHcDfP/b/fzLcleIWwnel0F1Dz0A5VF39g9S/NYo1Ttt+MphnWfKl+Za6Rp8z/M=
